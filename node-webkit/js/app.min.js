function App(a){this.caption=document.getElementById("event-caption"),this.list=document.getElementById("list-table"),this.event=a.eventData,this.attendance=a.attendance,this.startup()}var Module={};!function(a){"use strict";function b(a){return"function"==typeof a}function c(){}function d(a){return a===h.SUCCESS?"success":a===h.FAIED?"failed":a===h.ABORT?"abort":void 0}function e(a){return a&&"Lazy"===a._interface}function f(a){return a instanceof i?a.lazy:a}function g(a){this.lazy=a}function h(){this.id=++J,this._proceeded=!1,this._appointID=0,this._status=h.SUSPEND,this._message=void 0,this._progress=null,this._pipes={1:null,16:null,17:null},this._callbacks={1:[],16:[],17:[]},this._chain=null,this.signal=new g(this)}function i(a){this.lazy=a}function j(a){return this.send(h.SUCCESS,a)}function k(a){return this.send(h.FAILED,a)}function l(a){return this.send(h.ABORT,a)}function m(a,b){var c=this.lazy;return c._changeStatus(a,b),c}function n(a){return this.lazy._status===h.SUSPEND&&b(this.lazy._progress)&&this.lazy._progress(a),this.lazy}function o(a,b,c){return this._pipes[h.SUCCESS]=a,this._pipes[h.FAILED]=b,this._pipes[h.ABORT]=c,this}function p(a){return this._callbacks[h.SUCCESS].push([a,0]),this.isSuccess()&&this._execute(),this.promise()}function q(){return this._status===h.SUCCESS}function r(a){return this._callbacks[h.FAILED].push([a,0]),this.isFailed()&&this._execute(),this.promise()}function s(){return this._status===h.FAILED}function t(a){return this._callbacks[h.ABORT].push([a,0]),this.isAbort()&&this._execute(),this._promise()}function u(){return this._status===h.ABORT}function v(a){return this._callbacks[h.SUCCESS].push([a,0]),this._callbacks[h.ABORT].push([a,0]),this._callbacks[h.FAILED].push([a,0]),(this.isSuccess()||this.isAbort()||this.isFailed())&&this._execute(),this.promise()}function w(){for(var a,c,d=new h,g=["success","failed","abort"],j=-1;arguments[++j];)a=arguments[j],c=g[j],this[c](function(){var g,h=b(a)?a():a;e(h)?(g=f(h),g[c](function(){d.signal[c].apply(d.signal,arguments)})):d.signal[c]()});return new i(d)}function x(){return this._chain=new h,this._chain}function y(a){this._appointID=a}function z(){return this._message}function A(a,b){this._proceeded||(this._proceeded=!0,this._status=a,this._message=b,this._execute())}function B(a){var c=this,f=-1,g=this._status,h=this._callbacks[g]||[],i=b(this._pipes[g])&&!a?this._pipes[g](this._message):this._message;if(e(i)&&a)return i[d(g)](function(){c._message=i.getMessage(),c._execute(!0)});for(;h[++f];)b(h[f][0])&&0===h[f][1]&&(h[f][1]=1,this.parallel?h[f][0].apply(this,i):h[f][0](i));this._process(g,i)}function C(a,b){this._appointID>0&&this._appointID in K&&K[this._appointID].signal.send(a,b),this._chains&&this._chains[a].signal.send(a,b)}function D(){return new i(this)}function E(a){return this._progress=a,this}function F(a){if(a&&"Lazy"===a._interface)return a.setAppointID(this._appointID),this._lazy[this._lazy.length]=a,this;throw new Error("Argument must be Lazy instance!")}function G(a){var b=!0,c=-1,d=[];if(!this._proceeded){if(a===h.SUCCESS)for(;this._lazy[++c];){if(e(this._lazy[c])&&f(this._lazy[c])._status!=h.SUCCESS){b=!1;break}d.push(this._lazy[c].getMessage())}else for(b=!1;this._lazy[++c];)f(this._lazy[c])._status==h[a]&&(b=!0),d.push(this._lazy[c].getMessage());b===!0&&(this._proceeded=!0,this._status=a,this._message=d,this._execute())}}function H(){delete K[this._appointID]}var I,J=0,K=[],L=/^is|parallel|promise|then/;Object.prototype.toString,a.Lazy=h,g.prototype={constructor:g,success:j,failed:k,abort:l,send:m,notify:n},h.SUSPEND=0,h.SUCCESS=1,h.FAILED=16,h.ABORT=17,h.make=function(){return new h},h.extend=function(a){return a._interface="Lazy",a},h.prototype={_interface:"Lazy",constructor:h,pipe:o,success:p,isSuccess:q,failed:r,isFailed:s,abort:t,isAbort:u,always:v,then:w,chain:x,setAppointID:y,getMessage:z,_changeStatus:A,_execute:B,_process:C,promise:D,progress:E},h.Parallel=function(){var a,b=-1;for(h.call(this),this._appointID=++J,this._lazy=[],this.parallel=!0;arguments[++b];)a=arguments[b],e(a)&&(a.setAppointID(this._appointID),this._lazy[this._lazy.length]=a);return K[this._appointID]=this,this},h.Parallel.prototype={_interface:"Lazy",constructor:h.Parallel,promise:D,success:p,isSuccess:q,failed:r,isFailed:s,abort:t,chain:x,isAbort:u,pipe:o,getMessage:z,_execute:B,progress:E,_changeStatus:G,append:F,_process:H},i.prototype={_interface:"Lazy",constructor:i,signal:{success:c,failed:c,abort:c,notify:function(a){n.call(this,a)}}};for(I in h.prototype)!I.isPrototypeOf(h.prototype)&&b(h.prototype[I])&&!function(a){i.prototype[a]=function(){var b=h.prototype[a],c=b.apply(this.lazy,arguments);return L.test(a)?c:this}}(I)}("undefined"!=typeof Module?Module:this),function(a){function b(){}var c=openDatabase("zusaar","1.0","zusaar attendance db",2097152);c.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS attendance ( id integer primary key, userid integer, name test, is_attended integer )")}),b.query=function(b,d){var e=new a.Lazy,f=d||[];return c.transaction(function(a){a.executeSql(b,f,function(a,b){b?e.signal.success(Array.prototype.slice.call(b)):e.signal.failed()})}),e},a.DB=b}("undefined"!=typeof Module?Module:this),function(a){function b(b,d){var e=new a.Lazy;return d&&e.success(d),c.get(b,function(a){var b="";return 200!=a.statusCode?(e.signal.failed(a),void 0):(a.setEncoding("utf8"),a.on("data",function(a){b+=a}),a.on("end",function(){e.signal.success(b)}),void 0)}),e.promise()}var c=require("http");a.http=b}("undefined"!=typeof Module?Module:this);var gui=require("nw.gui");onload=function(){var a=gui.Window.get();a.maximize(),a.show()},App.EventID="984003",App.init=function(){var a,b=document.getElementById("layer"),c={attendance:{},eventData:null};a=Module.DB.query("SELECT * FROM attendance ORDER BY id ASC",[]),a.success(function(a){for(var b=a.length,d=0;b>d;++d)c.attendance[a.user_id]=a}).then(function(){return Module.http({hostname:"www.zusaar.com",port:80,method:"GET",path:"/api/event/user/?event_id="+App.EventID})}).success(function(a){var d=JSON.parse(a);c.eventData=d.event[0],b.style.display="none",new App(c)}).failed(function(){b.style.display="none"})},App.prototype.startup=function(){this.createCaption(this.event),this.createListView(this.event.users)},App.prototype.createCaption=function(a){var b=['<span class="title">'+a.title+"<span>",'<em class="accept">'+a.accepted+"</em>","/",'<em class="limit">'+a.limit+"</em>","(補欠&nbsp;"+a.waiting+"人)"];this.caption.innerHTML=b.join("")},App.prototype.createListView=function(a){for(var b,c,d,e=document.createElement("ul"),f=-1;a[++f];)b=a[f],d=b.user_id in this.attendance&&this.attendance[b.user_id].is_attended>0,c=document.createElement("li"),c.setAttribute("data-userid",b.user_id),c.setAttribute("class","status"+b.status),c.setAttribute("data-attendance",d?"on":"off"),c.innerHTML="<div>"+b.nickname+"<span>"+(b.status>0?"":"（補欠）")+"</span></div>",e.appendChild(c);this.list.appendChild(e)};